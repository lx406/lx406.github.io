<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单元测试 | Xiang&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.edd0e32f.js" as="script"><link rel="preload" href="/assets/js/2.6ad20504.js" as="script"><link rel="preload" href="/assets/js/3.4f772477.js" as="script"><link rel="prefetch" href="/assets/js/10.83ad3917.js"><link rel="prefetch" href="/assets/js/11.ce94b172.js"><link rel="prefetch" href="/assets/js/12.7e578634.js"><link rel="prefetch" href="/assets/js/13.fc3d457f.js"><link rel="prefetch" href="/assets/js/14.163e86a2.js"><link rel="prefetch" href="/assets/js/15.f3f5df27.js"><link rel="prefetch" href="/assets/js/16.d6352424.js"><link rel="prefetch" href="/assets/js/17.0a5440b4.js"><link rel="prefetch" href="/assets/js/18.87707989.js"><link rel="prefetch" href="/assets/js/4.a04b886e.js"><link rel="prefetch" href="/assets/js/5.cf097153.js"><link rel="prefetch" href="/assets/js/6.9e2bed46.js"><link rel="prefetch" href="/assets/js/7.5f808fab.js"><link rel="prefetch" href="/assets/js/8.3da66210.js"><link rel="prefetch" href="/assets/js/9.bff0ee0e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/qianduaner.jpeg" alt="Xiang's Blog" class="logo"> <span class="site-name can-hide">Xiang's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/es6/symbol.html" class="nav-link">
  es6
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="test menu" class="dropdown-title"><span class="title">test</span> <span class="arrow down"></span></button> <button type="button" aria-label="test menu" class="mobile-dropdown-title"><span class="title">test</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/test/test.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  test
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/unitTest.html" class="nav-link">
  unit test
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/test-utils.html" class="nav-link">
  @vue/test-utils
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/tdd.html" class="nav-link">
  tdd
</a></li></ul></div></div><div class="nav-item"><a href="/pages/browser/浏览器工作原理.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/pages/algorithm/stableSort.html" class="nav-link">
  algorithm
</a></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/es6/symbol.html" class="nav-link">
  es6
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="test menu" class="dropdown-title"><span class="title">test</span> <span class="arrow down"></span></button> <button type="button" aria-label="test menu" class="mobile-dropdown-title"><span class="title">test</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/test/test.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  test
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/unitTest.html" class="nav-link">
  unit test
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/test-utils.html" class="nav-link">
  @vue/test-utils
</a></li><li class="dropdown-item"><!----> <a href="/pages/test/tdd.html" class="nav-link">
  tdd
</a></li></ul></div></div><div class="nav-item"><a href="/pages/browser/浏览器工作原理.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/pages/algorithm/stableSort.html" class="nav-link">
  algorithm
</a></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/test/test.html" aria-current="page" class="active sidebar-link">单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/test/test.html#单元测试" class="sidebar-link">单元测试</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#测试框架" class="sidebar-link">测试框架</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#test-suit-test-case" class="sidebar-link">test suit/test case</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#断言" class="sidebar-link">断言</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#异步测试" class="sidebar-link">异步测试</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#环境准备" class="sidebar-link">环境准备</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#mock" class="sidebar-link">Mock</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#snapshot" class="sidebar-link">Snapshot</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#测试覆盖率" class="sidebar-link">测试覆盖率</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#测试报告" class="sidebar-link">测试报告</a></li><li class="sidebar-sub-header"><a href="/pages/test/test.html#e2e测试" class="sidebar-link">E2E测试</a></li></ul></li><li><a href="/pages/test/unitTest.html" class="sidebar-link">单元测试原则</a></li><li><a href="/pages/test/test-utils.html" class="sidebar-link">@vue/test-utils</a></li><li><a href="/pages/test/tdd.html" class="sidebar-link">tdd导览</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h2> <h3 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么</h3> <ol><li>单元测试应该只测试一个独立单元的工作</li> <li>前端单元测试，往往是以组件、util（test-suit）为粒度，很少有以整个页面为粒度的</li></ol> <h3 id="为什么"><a href="#为什么" class="header-anchor">#</a> 为什么</h3> <p>提升软件质量，保证代码重构质量</p> <h2 id="测试框架"><a href="#测试框架" class="header-anchor">#</a> 测试框架</h2> <p>推荐使用Jest</p> <h3 id="jest"><a href="#jest" class="header-anchor">#</a> Jest</h3> <ol><li>开箱即用：基本不需要额外的配置即可使用</li> <li>自带断言、测试覆盖率工具，支持Mock、Snapshot、异步测试等</li> <li>应用广泛：已经成为了vue-cli和create-react-app默认集成的测试框架</li> <li>文档丰富</li></ol> <h2 id="test-suit-test-case"><a href="#test-suit-test-case" class="header-anchor">#</a> test suit/test case</h2> <h3 id="test-case"><a href="#test-case" class="header-anchor">#</a> test case</h3> <p>测试用例，表示对一个功能点的测试
在Jest中一个test即为一个test，第一个参数为case名称，第二个是要执行的函数</p> <h3 id="test-suit"><a href="#test-suit" class="header-anchor">#</a> test suit</h3> <p>测试套件，表示一组相关用例的分组
describe表示一个test suit，第一个参数为suit名称，第二个是执行的函数</p> <div class="language- extra-class"><pre class="language-text"><code>const a = {
    name: 'lx',
    age: 18
}

// test suit
describe('a',()=&gt;{
    // test case
    test('name',()=&gt;{
        expect(a.name).toBe('lx');
    });
    test('age',()=&gt;{
        expect(a.age).toBe(18);
    })
})
</code></pre></div><h2 id="断言"><a href="#断言" class="header-anchor">#</a> 断言</h2> <h3 id="断言是什么"><a href="#断言是什么" class="header-anchor">#</a> 断言是什么</h3> <ol><li>在程序设计中，断言是一种一阶逻辑，目的是表示与验证开发者预期的结果。</li> <li>当程序运行到断言的位置时，对应的断言应该为真。若断言为假时，程序会中止并给出错误信息。</li></ol> <h3 id="jest中的断言"><a href="#jest中的断言" class="header-anchor">#</a> Jest中的断言</h3> <p>Jest中内置了很多断言方法，称作为“Matcher”</p> <div class="language- extra-class"><pre class="language-text"><code>// Matcher的使用
test('Object assign',()=&gt;{
    const data = {one:1};
    data['two'] = 2;
    expect(data).toEqual({one:1,two:2});
})
// Matcher其实就是expect(something).toBe(something)
</code></pre></div><p>Jest中的Matchers,包含各种数据类型的各种判断方法</p> <div class="language- extra-class"><pre class="language-text"><code>test('Null',()=&gt;{
    const n = null;
    expect(n).toBeNull();
    expect(n).toBeDefined();
    expect(n),not.toBeUndefined();
    expect(n).not.toBeTruthy();
    expect(n).toBeFalsy();
});

test('two plus two', ()=&gt;{
    const value = 2 + 2;
    expect(value).toBeGreaterThan(3);
    expect(value).toBeGreaterThanOrEqual(3.5);
    expect(value).toBeLessThan(5);
    expect(value).toBeLessThanOrEqual(4.5);
    expect(value).toEqual(4); // '=='
    expect(value).toBe(4); // '==='
})
</code></pre></div><h2 id="异步测试"><a href="#异步测试" class="header-anchor">#</a> 异步测试</h2> <p>测试中难免遇到异步逻辑，Jest也提供了异步测试支持</p> <div class="language- extra-class"><pre class="language-text"><code>// 这个例子是错误的，因为Jest会认为是同步调用,在回调之前用例就结束了

test('the data is xxx', ()=&gt;{
    function callback(data){
        expect(data).toBe('xxx');
    }
    fetchData(callback);
})
</code></pre></div><h3 id="done"><a href="#done" class="header-anchor">#</a> done</h3> <p>Jest中提供done方法来支持异步测试</p> <div class="language- extra-class"><pre class="language-text"><code>test('the data is xxx', (done)=&gt;{
    function callback(data){
        try{
            expect(data).toBe('xxx');
            done();
        } catch (error){
            done(error);
        }
    }
    fetchData(callback);
})
</code></pre></div><p>Jest也提供了promise和async/await场景下的异步测试支持</p> <div class="language- extra-class"><pre class="language-text"><code>// promise
test('the data is peanut butter', ()=&gt;{
    return fetchData().then(data=&gt;{
        expect(data).toBe('peanut butter');
    })
})
// async/await
test('the data is xxx', ()=&gt;{
    await expect(fetchData()).resolves.toBe('xxx');
})
</code></pre></div><h2 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h2> <p>Jest提供了钩子函数：beforeEach、afterEach、beforeAll、afterAll</p> <ol><li>beforeEach：某些用例执行前</li> <li>afterEach：某些用例执行后</li> <li>beforeAll：所有用例执行前</li> <li>afterAll：所有用例执行后</li></ol> <div class="language- extra-class"><pre class="language-text"><code>// 在该文件中的所有test运行之前，都会执行
beforeEach(()=&gt;{
    return initData();
});
test('my name is lx',()=&gt;{
    expect(name).toBe('lx');
})
describe('lxs feature',()=&gt;{
    // 只会在这个test suit的每个test前运行
    beforEach(()=&gt;{
        return initData();
    })
    test('age',()=&gt;{
        expect(age).toBe(18);
    })
})
</code></pre></div><h2 id="mock"><a href="#mock" class="header-anchor">#</a> Mock</h2> <p>Mock是一种覆盖原有函数、类的实际实现，来检测其调用情况的一种测试方法。‘
在Jest中可以通过Mock函数的.mock属性，拿到Mock函数调用的各种信息</p> <div class="language- extra-class"><pre class="language-text"><code>const mockCallback = jest.fn(x=&gt;42+x);
forEach([0,1], mockCallback);

// mockCallback被调用两次
expect(mockCallback.mock.calls.length).toBe(2);
// mockCallback的第一次调用的第一个参数应该是0
expect(mockCallback.mock.calls[0][0]).toBe(0);
// mockCallback的第二次调用的第一个参数应该是1
expect(mockCallback.mock.calls[1][0]).toBe(1);
// mockCallback的第一次调用的结果应该是42
expect(mockCallback.mock.results[0].value).toBe(42);
</code></pre></div><h3 id="mock一个第三方模块"><a href="#mock一个第三方模块" class="header-anchor">#</a> Mock一个第三方模块</h3> <p><img src="/assets/img/example.4af47a73.png" alt="截屏2020-09-13 下午2.33.29.png"> <img src="/assets/img/example_answer.dce6ef51.png" alt="截屏2020-09-13 下午2.33.46.png"></p> <h2 id="snapshot"><a href="#snapshot" class="header-anchor">#</a> Snapshot</h2> <p>快照是一种非常强大的测试工具，一般用于UI组件的测试</p> <h2 id="测试覆盖率"><a href="#测试覆盖率" class="header-anchor">#</a> 测试覆盖率</h2> <p>我们用测试覆盖率衡量一个工程的测试代码的完整程度
Jest内置了Istanbul模块，可以从以下4个维度统计测试覆盖率：</p> <ol><li>Statements：语句覆盖率 所有语句的执行率</li> <li>Branches：分支覆盖率 所有代码分支如if、三目运算的执行率</li> <li>Functions：函数覆盖率 所有函数的被调用率</li> <li>Lines：行覆盖率 所有有效代码行的执行率，和语句类似，但是计算方式略有差别
<img src="/assets/img/coverage.c55915e4.png" alt="截屏2020-09-13 下午2.44.45.png"></li></ol> <h3 id="istanbul的原理"><a href="#istanbul的原理" class="header-anchor">#</a> Istanbul的原理</h3> <p>Istanbul在代码被执行之前，拦截了模块加载器，为其中的每一个逻辑分支、函数等添加了计数器，从而得到覆盖率结果。</p> <h2 id="测试报告"><a href="#测试报告" class="header-anchor">#</a> 测试报告</h2> <p>一次自动化测试的详情和最终结果，应该由一张测试报告描述</p> <p><img src="/assets/img/coverage_report.335043d9.png" alt="截屏2020-09-13 下午2.57.34.png"></p> <h2 id="e2e测试"><a href="#e2e测试" class="header-anchor">#</a> E2E测试</h2> <h3 id="是什么-2"><a href="#是什么-2" class="header-anchor">#</a> 是什么</h3> <ol><li>End to End，即“端到端”</li> <li>模仿用户，从某个入口开始，逐步执行操作，直到完成某项工作</li> <li>关注一个完整的操作链是否能够完成</li></ol> <h3 id="为什么-2"><a href="#为什么-2" class="header-anchor">#</a> 为什么</h3> <p>在单元测试的基础上，在更真实的场景下，测试软件质量。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/test/unitTest.html">
        单元测试原则
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.edd0e32f.js" defer></script><script src="/assets/js/2.6ad20504.js" defer></script><script src="/assets/js/3.4f772477.js" defer></script>
  </body>
</html>
